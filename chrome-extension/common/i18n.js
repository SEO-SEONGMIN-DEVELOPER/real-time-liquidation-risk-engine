const I18n = (() => {
  'use strict';

  const LANGS = ['en', 'ko', 'zh'];
  const DEFAULT_LANG = 'en';
  let current = DEFAULT_LANG;

  const T = {
    en: {
      title: 'Cascade Risk',
      symbol: 'Symbol',
      liqPrice: 'Liquidation Price',
      side: 'Side',
      leverage: 'Leverage',
      startMonitoring: 'Start Monitoring',
      stop: 'Stop',
      errSymbol: 'Please enter a symbol',
      errLiqPrice: 'Please enter liquidation price',
      reachProb: 'Reach Prob.',
      distance: 'Distance',
      direction: 'Direction',
      liqPriceLabel: 'Liq. Price',
      current: 'Current',
      details: 'Details',
      densityScore: 'Density Score',
      orderBookPath: 'Order Book Path',
      depth: 'Depth',
      notional: 'Notional',
      levels: 'Levels',
      depthRatio: 'Depth Ratio',
      liqClusters: 'Liquidation Clusters',
      noClusters: 'No clusters in range',
      marketPressure: 'Market Pressure',
      totalPressure: 'Total Pressure',
      dirDown: '▼ Down',
      dirUp: '▲ Up',
      popupTitle: 'Cascade Risk Monitor',
      popupIntro: 'A Chrome extension that analyzes <strong>cascade liquidation risk</strong> for Binance Futures positions in real-time. It evaluates the path from current price to liquidation price based on order book, open interest, and recent liquidation data.',
      popupUsageTitle: 'How to Use',
      popupUsage1: 'The widget appears automatically on the Binance Futures page.',
      popupUsage2: 'Enter <strong>Symbol</strong>, <strong>Liquidation Price</strong>, <strong>Side</strong> (Long/Short), and <strong>Leverage</strong>.',
      popupUsage3: 'Click <em>Start Monitoring</em> to begin real-time risk analysis.',
      popupUsage4: 'Expand <em>Details</em> to view detailed metrics.',
      popupBasicTitle: 'Basic Metrics',
      popupDetailTitle: 'Detail Metrics',
      descRiskLevel: 'Overall risk grade (LOW / MEDIUM / HIGH / CRITICAL)',
      descReachProb: 'Estimated probability of price reaching liquidation (%)',
      descDistance: 'Distance between current and liquidation price (%)',
      descDirection: 'Liquidation direction (Long→Down, Short→Up)',
      descDensity: 'Order book density score in the price range (0–100)',
      descDepthNotional: 'Order quantity (BTC) and notional value (USDT) in range',
      descLevelsRatio: 'Price levels in range / ratio to total order book',
      descClusters: 'Estimated liquidation clusters by leverage in range',
      descOI: 'Market pressure from OI change rate (0–20)',
      descLiq: 'Forced liquidation frequency + volume in last 30min (0–20)',
      descImbal: 'Order book bid/ask imbalance (0–20)',
      popupFooter: 'Binance Futures only · Real-time WebSocket',
    },
    ko: {
      title: '연쇄 청산 위험',
      symbol: '심볼',
      liqPrice: '청산가',
      side: '방향',
      leverage: '레버리지',
      startMonitoring: '모니터링 시작',
      stop: '중지',
      errSymbol: '심볼을 입력하세요',
      errLiqPrice: '청산가를 입력하세요',
      reachProb: '도달 확률',
      distance: '거리',
      direction: '방향',
      liqPriceLabel: '청산가',
      current: '현재가',
      details: '상세 보기',
      densityScore: '밀도 점수',
      orderBookPath: '호가창 경로',
      depth: '물량',
      notional: '명목가치',
      levels: '호가 단계',
      depthRatio: '물량 비율',
      liqClusters: '청산 클러스터',
      noClusters: '구간 내 클러스터 없음',
      marketPressure: '시장 압력',
      totalPressure: '총 압력',
      dirDown: '▼ 하락',
      dirUp: '▲ 상승',
      popupTitle: '연쇄 청산 위험 모니터',
      popupIntro: '바이낸스 선물 포지션의 <strong>연쇄 청산(Cascade Liquidation) 위험</strong>을 실시간으로 분석하는 확장 프로그램입니다. 현재가에서 청산가까지의 경로를 오더북, 미결제약정, 최근 청산 데이터를 기반으로 종합 평가합니다.',
      popupUsageTitle: '사용법',
      popupUsage1: '바이낸스 선물 페이지에 접속하면 위젯이 자동으로 나타납니다.',
      popupUsage2: '<strong>심볼</strong>, <strong>청산가</strong>, <strong>방향</strong>(Long/Short), <strong>레버리지</strong>를 입력합니다.',
      popupUsage3: '<em>모니터링 시작</em>을 누르면 실시간 위험 분석이 시작됩니다.',
      popupUsage4: '<em>상세 보기</em>를 펼치면 상세 지표를 확인할 수 있습니다.',
      popupBasicTitle: '기본 지표',
      popupDetailTitle: '상세 지표',
      descRiskLevel: '종합 위험 등급 (LOW / MEDIUM / HIGH / CRITICAL)',
      descReachProb: '가격이 청산가에 도달할 추정 확률 (%)',
      descDistance: '현재가와 청산가 사이의 거리 (%)',
      descDirection: '청산 방향 (Long→Down, Short→Up)',
      descDensity: '현재가~청산가 구간의 오더북 밀도 종합 점수 (0~100)',
      descDepthNotional: '구간 내 주문 수량(BTC) 및 명목가치(USDT)',
      descLevelsRatio: '구간 내 호가 단계 수 / 전체 오더북 대비 비율',
      descClusters: '구간 내 추정 청산 클러스터 (레버리지별 분포)',
      descOI: '미결제약정(OI) 변동률 기반 시장 압력 (0~20)',
      descLiq: '최근 30분 강제 청산 빈도 + 규모 (0~20)',
      descImbal: '오더북 매수/매도 불균형 정도 (0~20)',
      popupFooter: '바이낸스 선물 전용 · 실시간 WebSocket 연동',
    },
    zh: {
      title: '级联清算风险',
      symbol: '交易对',
      liqPrice: '清算价格',
      side: '方向',
      leverage: '杠杆',
      startMonitoring: '开始监控',
      stop: '停止',
      errSymbol: '请输入交易对',
      errLiqPrice: '请输入清算价格',
      reachProb: '到达概率',
      distance: '距离',
      direction: '方向',
      liqPriceLabel: '清算价',
      current: '当前价',
      details: '详细信息',
      densityScore: '密度评分',
      orderBookPath: '订单簿路径',
      depth: '深度',
      notional: '名义价值',
      levels: '价格档位',
      depthRatio: '深度比例',
      liqClusters: '清算集群',
      noClusters: '范围内无集群',
      marketPressure: '市场压力',
      totalPressure: '总压力',
      dirDown: '▼ 下跌',
      dirUp: '▲ 上涨',
      popupTitle: '级联清算风险监控',
      popupIntro: '实时分析币安合约仓位的<strong>级联清算(Cascade Liquidation)风险</strong>的扩展程序。基于订单簿、未平仓合约和近期清算数据，综合评估从当前价格到清算价格的路径。',
      popupUsageTitle: '使用方法',
      popupUsage1: '访问币安合约页面时，小部件会自动出现。',
      popupUsage2: '输入<strong>交易对</strong>、<strong>清算价格</strong>、<strong>方向</strong>(Long/Short)和<strong>杠杆</strong>。',
      popupUsage3: '点击<em>开始监控</em>启动实时风险分析。',
      popupUsage4: '展开<em>详细信息</em>查看详细指标。',
      popupBasicTitle: '基本指标',
      popupDetailTitle: '详细指标',
      descRiskLevel: '综合风险等级 (LOW / MEDIUM / HIGH / CRITICAL)',
      descReachProb: '价格到达清算价的估计概率 (%)',
      descDistance: '当前价与清算价之间的距离 (%)',
      descDirection: '清算方向 (Long→下跌, Short→上涨)',
      descDensity: '当前价~清算价区间的订单簿密度综合评分 (0~100)',
      descDepthNotional: '区间内订单数量(BTC)及名义价值(USDT)',
      descLevelsRatio: '区间内价格档位数 / 占总订单簿比例',
      descClusters: '区间内按杠杆分布的预估清算集群',
      descOI: '基于未平仓合约(OI)变动率的市场压力 (0~20)',
      descLiq: '最近30分钟强制清算频率 + 规模 (0~20)',
      descImbal: '订单簿买卖不平衡程度 (0~20)',
      popupFooter: '仅限币安合约 · 实时WebSocket连接',
    },
  };

  function get(key) {
    return (T[current] && T[current][key]) || T[DEFAULT_LANG][key] || key;
  }

  function setLang(lang) {
    if (LANGS.includes(lang)) current = lang;
  }

  function getLang() {
    return current;
  }

  function getLangs() {
    return LANGS;
  }

  return { get, setLang, getLang, getLangs, T };
})();
